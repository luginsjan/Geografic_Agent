<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SOP Graphic Report - Agente Geogr√°fico</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div id="app-container">
        <div id="welcome-section">
            <h1>Test SOP Graphic in Final Report</h1>
            <p>Testing the confirmed SOP section with elevation chart and PDF generation (one page).</p>
        </div>
        
        <div id="status-message" style="display:none;"></div>
        
        <!-- Test buttons -->
        <div style="text-align: center; margin: 2rem 0;">
            <button onclick="testSOPGraphicReport()" style="margin: 0.5rem; padding: 1rem 2rem; background: #4CAF50; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Test SOP Graphic Report
            </button>
            <button onclick="testPDFGeneration()" style="margin: 0.5rem; padding: 1rem 2rem; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Test PDF Generation
            </button>
            <button onclick="testSOPErrorCase()" style="margin: 0.5rem; padding: 1rem 2rem; background: #c00; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Test SOP Error Case
            </button>
        </div>
        
        <!-- Final Report Container -->
        <div id="final-report-block" style="display: none;">
            <h2>Reporte Final</h2>
            <div class="final-report-container">
                <!-- Report Header -->
                <div class="report-header">
                    <h3>Agente Geogr√°fico - An√°lisis Completado</h3>
                    <div class="report-meta">
                        <p class="report-date">Fecha: <span id="report-date"></span></p>
                        <p class="report-id">Workflow ID: <span id="report-aigent-id"></span></p>
                        <p class="report-timestamp">Timestamp: <span id="report-timestamp"></span></p>
                        <p class="report-duration">Tiempo Requerido: <span id="report-duration"></span></p>
                    </div>
                </div>
                
                <!-- Input Section -->
                <div class="report-section">
                    <h4>Datos de Entrada</h4>
                    <div class="input-details">
                        <div class="input-item">
                            <span class="input-label">Coordenadas/Direcci√≥n:</span>
                            <span class="input-value" id="report-coordinates"></span>
                        </div>
                        <div class="input-item">
                            <span class="input-label">Ancho de Banda:</span>
                            <span class="input-value" id="report-bandwidth"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Confirmed SOP Section -->
                <div class="report-section">
                    <h4>SOP Confirmado</h4>
                    <div id="report-sop-details" class="sop-details">
                        <!-- SOP details and chart will be populated here -->
                    </div>
                </div>
                
                <!-- Confirmed Kit Section -->
                <div class="report-section">
                    <h4>Kit Confirmado</h4>
                    <div id="report-kit-details" class="kit-details">
                        <!-- Kit details will be populated here -->
                    </div>
                </div>
                
                <!-- Download Button -->
                <div class="report-actions">
                    <button id="download-pdf-button" class="download-pdf-button">
                        <span class="download-icon">üìÑ</span>
                        Descargar Reporte PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
    <script>
        // Test function for SOP graphic in final report
        function testSOPGraphicReport() {
            console.log('Testing SOP graphic in final report...');
            
            // Set test data
            currentAigentID = "AIG-20250712-200313-9RQS6";
            inputCoordinates = "Calle Principal 123, Ciudad de M√©xico";
            inputBandwidth = "100 Mbps";
            
            // Set test time tracking (simulate 2 minutes 30 seconds)
            workflowStartTime = new Date(Date.now() - 150000); // 2m 30s ago
            workflowEndTime = new Date();
            
            confirmedSOP = {
                id: "SOP-00008",
                data: {
                    SOP: "SOP-00008",
                    Plaza: "Plaza Central",
                    distance_km: "2.5",
                    Coordenadas: "19.4326¬∞ N, 99.1332¬∞ W",
                    elevation: "2,240 m",
                    status: "Clear",
                    results: Array.from({length: 30}, (_, i) => ({ elevation: 2200 + Math.sin(i/5)*30 })),
                    lineOfSight: {
                        hasLineOfSight: true,
                        totalDistanceKm: 2.5,
                        firstPoint: { adjustedElevation: 2230 },
                        lastPoint: { adjustedElevation: 2240 },
                        obstructionCount: 0,
                        summary: {
                            canSee: true,
                            recommendation: "Line of sight confirmed - connection possible"
                        }
                    }
                }
            };
            
            confirmedKit = {
                name: "KIT 1",
                radio: "Mimosa C5x",
                antenna: "Antena Mimosa N5X25",
                frequency_band: "4.9 - 6.4 GHz",
                max_throughput: "700 Mbps",
                transmit_power: "27 dBm",
                antenna_gain: "25 dBi",
                link_margin: "21.36 dB",
                cost: "691 USD"
            };
            
            // Show final report
            showFinalReport();
            
            console.log('SOP graphic test completed');
        }
        
        // Test function for PDF generation
        function testPDFGeneration() {
            console.log('Testing PDF generation with SOP graphic...');
            
            // First populate the report
            testSOPGraphicReport();
            
            // Wait a moment for the report to populate, then generate PDF
            setTimeout(() => {
                downloadPDF();
            }, 1200);
        }

        // Test function for error case (no SOP)
        function testSOPErrorCase() {
            confirmedSOP = null;
            showFinalReport();
        }
        
        // Make functions available globally
        window.testSOPGraphicReport = testSOPGraphicReport;
        window.testPDFGeneration = testPDFGeneration;
    </script>
</body>
</html> 